<!-- Loading indicator - always present but only shows when loading -->
<app-loadal #loadal></app-loadal>

<!-- Main form container - only shown when form is initialized -->
<div *ngIf="form">
  <!-- STEP 1: Collection ID Selection -->
  <section #collectionIdSection>
    <div class="d-flex flex-column align-items-center justify-content-center my-5">
      <!-- Step 1 header with help link -->
      <div class="d-flex align-items-center mb-5">
        <h5 class="text-center me-2 my-0">Step 1: Select Partition Information
        </h5>
        <a
          class="p-0"
          href="https://github.com/bcgov/reserve-rec-api/wiki/Data-Model#activity-collections"
          target="_blank"
          noreferrer
          noopener
        >
          <button class="btn btn-outline-secondary py-0 px-2">
            <i class="fa-solid fa-question fa-xs"></i>
          </button>
        </a>
      </div>
      <!-- Collection ID instructions and warnings -->
      <div class="text-center mb-2">
        Enter the <strong>Collection ID</strong> and <strong>Activity Type</strong> for the activity you are creating. A
        <strong>Collection ID</strong> is an
        identifier that differentiates groups of activities within the system based on their
        purpose, ownership, or intended audience.
      </div>
      <div class="mb-2">
        An <strong>Activity Type</strong> is a classification that describes the type of experience being offered by the
        activity, like camping, day use, boating, etc.
      </div>
      <div class="mb-2">
        Make sure the <strong>Collection ID</strong> is correct, as it cannot be changed later.
      </div>

      <!-- Collection ID input field -->
      <div class="row">
        <div class="col">
          <ngds-text-input
            [control]="form.get('collectionId')"
            [label]="'Collection ID'"
            [placeholder]="'Enter Collection ID'"
            [resetButton]="true"
            [disabled]="activity?.collectionId"
          >
          </ngds-text-input>
        </div>
        <div class="col">
          <ngds-typeahead-input
            [control]="form.get('activityType')"
            [selectionListItems]="activityTypes"
            [label]="'Activity Type'"
            [placeholder]="'Select Activity Type'"
            [resetButton]="true"
            [disabled]="activity?.activityType"
          >
          </ngds-typeahead-input>
        </div>
      </div>
    </div>
  </section>

  <hr>

  <!-- STEP 2: Mandatory Fields -->
  <section #mandatoryFieldsSection>
    <div class="d-flex flex-column align-items-center justify-content-center my-5">
      <!-- Step 2 header with help link -->
      <div class="d-flex align-items-center mb-5">
        <h5 class="text-center me-2 my-0">Step 2: Complete Mandatory Fields</h5>
        <a
          class="p-0"
          href="https://github.com/bcgov/reserve-rec-api/wiki/Data-Model#activity-properties"
          target="_blank"
          noreferrer
          noopener
        >
          <button class="btn btn-outline-secondary py-0 px-2">
            <i class="fa-solid fa-question fa-xs"></i>
          </button>
        </a>
      </div>

      <!-- Step 2 instructions -->
      <div class="text-center mb-2">
        Complete the mandatory fields for the activity you are creating. These fields are required to ensure that the
        activity is properly defined and can be used within the system.
      </div>

      <!-- Display Name Field -->
      <div class="row w-100 d-flex justify-content-center mt-3 mb-5">
        <div class="col-lg-6 d-flex flex-column justify-content-left mb-2">
          <ngds-text-input
            [control]="form.get('displayName')"
            [label]="'Activity Name'"
            [placeholder]="'Activity Name'"
            [resetButton]="true"
          >
          </ngds-text-input>
        </div>
      </div>

      <div class="alert alert-info text-center">
        <i class="fa-solid fa-info-circle me-2"></i>
        To link this activity to facilities, geozones, or products, use the 
        <strong>Entity Relationships</strong> tool.
      </div>
      <button 
        *ngIf="activity?.activityId"
        class="btn btn-primary mt-3" (click)="navigateToEntityRelationships()"
      >
        <i class="fa-solid fa-circle-nodes"></i>
        <span> Go to Entity Relationships</span>
      </button>
    </div>
  </section>

  <hr>

  <!-- STEP 3: Optional Fields -->
  <section #optionalFieldsSection>
    <div class="d-flex flex-column align-items-center justify-content-center my-5">
      <!-- Step 3 header with help link -->
      <div class="d-flex align-items-center mb-5">
        <h5 class="text-center me-2 my-0">Step 3: Complete Optional Fields</h5>
        <a
          class="p-0"
          href="https://github.com/bcgov/reserve-rec-api/wiki/Data-Model#activity-properties"
          target="_blank"
          noreferrer
          noopener
        >
          <button class="btn btn-outline-secondary py-0 px-2">
            <i class="fa-solid fa-question fa-xs"></i>
          </button>
        </a>
      </div>

      <!-- Step 3 instructions -->
      <div class="text-center mb-2">
        Complete the optional fields for the activity you are creating.
      </div>
    </div>

    <div class="row">
      <!-- Left column - Form fields -->
      <div class="col-lg-6 d-flex flex-column justify-content-left mb-2">
        <!-- Activity Sub Type (hidden for group camps) -->
        <div *ngIf="form.get('activityType')?.value !== 'groupCamp'">
          <ngds-picklist-input
            [control]="form.get('activitySubType')"
            [label]="'Activity Sub Type'"
            [selectionListItems]="activitySubTypes"
            [placeholder]="'Select an activity sub type'"
            [resetButton]="true"
          >
          </ngds-picklist-input>
        </div>

        <!-- Public visibility toggle -->
        <ngds-toggle-input
          [control]="form.get('isVisible')"
          [switch]="true"
          [label]="'Toggle public visibility of the activity. If unchecked, the activity will not be visible to public users.'"
        ></ngds-toggle-input>

        <!-- Activity description -->
        <ngds-text-input
          [control]="form.get('description')"
          [label]="'Description'"
          [multiline]="true"
          [placeholder]="'Enter a description for the activity'"
          [resetButton]="true"
        >
        </ngds-text-input>

        <!-- Search terms component -->
        <app-search-terms
          #searchTerms
          [searchTerms]="form.get('searchTerms')?.value || []"
          (searchTermsChange)="onSearchTermsChange($event)"
          (searchTermDirty)="onSearchTermDirty()"
        ></app-search-terms>

        <!-- Administrative notes -->
        <ngds-text-input
          [control]="form.get('adminNotes')"
          [label]="'Administrative Notes'"
          [multiline]="true"
          [placeholder]="'Enter administrative notes'"
          [resetButton]="true"
        >
        </ngds-text-input>
      </div>

      <!-- Right column - Image preview -->
      <div class="col-lg-6 d-flex flex-column justify-content-left mb-2">
        <!-- Image URL input -->
        <ngds-text-input
          [control]="form.get('imageUrl')"
          [label]="'Image URL'"
          [placeholder]="'Paste Image URL here'"
          [resetButton]="true"
        >
        </ngds-text-input>

        <!-- Image preview container -->
        <div
          class="w-100 rounded-5 mt-2 border text-center text-muted d-flex align-items-center justify-content-center"
          [ngStyle]="{'min-height': form.get('imageUrl').value ? 'auto' : '500px'}"
        >
          <img
            [src]="form.get('imageUrl').value"
            class="img-fluid rounded-5 p-1"
            [class.border]="form.get('imageUrl').value"
            width="100%"
            height="auto"
            alt="No image of {{form.get('displayName').value}}"
          >
        </div>
      </div>
    </div>
  </section>
  <hr>
</div>


